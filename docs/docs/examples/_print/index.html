<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.121.1">
<link rel="canonical" type="text/html" href="/docs/examples/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/examples/index.xml">
<meta name="robots" content="noindex, nofollow">
<script defer data-domain="butler.ptarmiganlabs.com" src="https://plausible.io/js/script.js"></script>



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Examples | Butler</title>
<meta name="description" content="Butler in action!
">
<meta property="og:title" content="Examples" />
<meta property="og:description" content="Butler in action!
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/examples/" />

<meta itemprop="name" content="Examples">
<meta itemprop="description" content="Butler in action!
"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Examples"/>
<meta name="twitter:description" content="Butler in action!
"/>




<link rel="preload" href="/scss/main.min.760be0d42a95747f7072e6cf9b47cc5c5c4d7715dd765fd062712100e6b3d9d8.css" as="style">
<link href="/scss/main.min.760be0d42a95747f7072e6cf9b47cc5c5c4d7715dd765fd062712100e6b3d9d8.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-00000000-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">Butler</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/examples/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Examples</h1>
<div class="lead">Butler in action!</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-a7214d8eb05721a11d3f508abe2cf8ad">Swagger UI: Try out the Butler API using the API docs</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-3921979a19a7683063bf6e732bd094ed">Flexible scheduling of Sense reload tasks</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-5230cabc1ee17ee5a7b958adafbe276d">Reload task chaining with parameters</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-623bc4dd163a7c6e1fbd68416cc6196b">Monitoring Butler&#39;s memory usage using Grafana</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-8660cd4d7d82d2525980be7a70d69444">Start Sense tasks using Butler APIs</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-9ec46b6cc378b2854c350e850ccc1a0e">Start Sense tasks using REST API</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5.2: <a href="#pg-14f1eed47ec7650ca73aa0b550f5b150">Start Sense tasks from load script of Sense apps</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5.3: <a href="#pg-a68f4373aa21a7c97708868e6800c445">Start Sense tasks using MQTT</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-0b7938483d12cedb172dda070edbd078">Controlled and secure file system operations</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-d2af2c1244624a9acc9a66e66172d1fb">Sense apps that explain and highlight various Butler features</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-80b3dd32c9d3f4baac903f189466eec8">Using Butler APIs from Sense load script</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7.2: <a href="#pg-43c4ed843dd44f1efb5f941ab5acde72">Partial loads in Qlik Sense</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7.3: <a href="#pg-bbc60cbb61fac1179012dec229c48586">Post message to Slack</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7.4: <a href="#pg-7125aa4f0e91e8edd48c7230f440bf3b">Publish message to MQTT</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-89b0a8b47f0fe64f0420ca0c37b51a0f">Run Butler as a Windows service</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>First things first:</p>
<p>If you intend to use the various Qlik script snippets included in the GithHub repository, you first need to initialize things.</p>
<p>Initializing Butler in an app&rsquo;s load script is easy, just call the <code>ButlerInit</code> function.</p>
<p>Note: It&rsquo;s usually a good idea to create a shared data connection for scripts that are available to all Sense apps.<br>
In the example below this shared data connection is simply called &ldquo;Butler scripts&rdquo;:</p>
<pre><code>$(Must_Include=[lib://Butler scripts/butler_init.qvs]);
CALL ButlerInit;
</code></pre>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a7214d8eb05721a11d3f508abe2cf8ad">1 - Swagger UI: Try out the Butler API using the API docs</h1>
    <div class="lead">Assuming Butler is properly configured and running, it&rsquo;s easy to try out Butler&rsquo;s API.
This page shows some examples of interactions with the Butler API.</div>
	<p>Below are some examples of how Butler&rsquo;s built-in Swagger docs can be used to test-drive the Butler API.</p>
<p>Note: Some of the videos below were created with older Butler versions.<br>
Details may have changed (for example what API parameters are available), the general concepts remain the same though.</p>
<h2 id="openapi-documentation-built-into-butler">OpenAPI documentation built into Butler</h2>
<p>The complete documentation for Butler&rsquo;s REST API is built into Butler itself.
This means that its very easy to try out and get familiar with the various API endpoints, without having to create Sense apps for everything you want to try out.</p>
<p>If Butler&rsquo;s config file contains the settings below, the API will be available at http://192.168.1.168:8080.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">restServerConfig</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">serverHost</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">192.168.1.168</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">serverPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">backgroundServerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8083</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In addition to the API endpoints, the API documentation will be available at http://192.168.1.168:8080/documentation.<br>
The beauty of the Swagger docs is that you can also test drive the API itself. If you have Butler running it&rsquo;s thus super easy to test the various REST API endpoints.</p>
<p>The API doc page looks like this:</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 812px">
	<img class="card-img-top" src="/docs/examples/openapi-docs/openapi-latest-1_hua3038860b6359b9abb1d81d9ee348589_397677_0x650_resize_catmullrom_3.png" width="802" height="650">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
</p>
	</figcaption>
	
</figure>



<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Other tools for exploring APIs</h4>

    <p>If the OpenAPI interface to Butler&rsquo;s API feels limited, there are lots of tools dedicated to this task.<br>
Two good ones are:</p>
<ul>
<li><a href="https://paw.cloud/">Paw</a> is Mac only, costs a bit of money, but is very, very good. Highly recommended.</li>
<li><a href="https://www.postman.com/">Postman</a> is also good and cross platform.</li>
</ul>

</div>

<h3 id="butler-ping">Butler ping</h3>
<p>This is the most basic API endpoint of them all. Can be used to verify that Butler is actually running and responding as expected.</p>
<p>Looks like this. Note the response we get from Butler&rsquo;s API.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/K_1f_hSZ-4k?enablejsapi=1"
                 allowfullscreen></iframe>
</div>
<h3 id="list-all-enabled-api-endpoints">List all enabled API endpoints</h3>
<p>Let&rsquo;s take a look at which API endpoints are <a href="/docs/reference/config-file/">enabled in the restServerEndpointsEnable section of the config file</a>:</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/JdOt1aQj9Hw?enablejsapi=1"
                 allowfullscreen></iframe>
</div>
<h3 id="key-value-pairs-demo-1">Key-value pairs, demo 1</h3>
<p>Create and query key-value pairs.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/Vx9MVODo38E?enablejsapi=1"
                 allowfullscreen></iframe>
</div>
<h3 id="schedules-demo-1">Schedules, demo 1</h3>
<p>Create, query, edit and delete task reload schedules using Butler&rsquo;s scheduling API.</p>
<p>When wathcing the video below, you will notice there are two pre-defined schedules.<br>
One of them fires every 30 seconds and this is also visible in the Butler logs:</p>
<p><img src="butler-running-schedules-firing-1.png" alt="alt text" title="Active user sessions"></p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/f-ZSUvXeFmw?enablejsapi=1"
                 allowfullscreen></iframe>
</div>
<h3 id="list-available-sense-apps-and-extract-them-as-json">List available Sense apps and extract them as JSON</h3>
<p>List existing apps on Sense server, then export one of them to JSON.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/vFB0u_eLsJs?enablejsapi=1"
                 allowfullscreen></iframe>
</div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3921979a19a7683063bf6e732bd094ed">2 - Flexible scheduling of Sense reload tasks</h1>
    <div class="lead">Examples showing how to use the Butler scheduler using direct API calls.</div>
	<p>There are many ways to call REST APIs. In this page curl is used, but the same tests can be done using <a href="https://paw.cloud/">Paw</a>, <a href="https://www.postman.com/">Postman</a> and by using the <a href="https://help.qlik.com/en-US/connectors/Subsystems/REST_connector_help/Content/Connectors_REST/REST-connector.htm">REST connector</a> from within Qlik Sense load scripts.</p>
<p>All the examples assume Butler is exposing it&rsquo;s API on 192.168.1.168:8080.</p>
<h2 id="list-all-defined-schedules">List all defined schedules</h2>
<p>Looks like there is currently one schedule:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">306</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">306</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">16498</span>      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:-- <span style="color:#0000cf;font-weight:bold">20400</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2021-10-08T07:24:38.373Z&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;* */2 * * *&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;3702cec1-b6c8-463e-bda3-58d6a94dd9ac&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 2 hours&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>         <span style="color:#4e9a06">&#34;tag 3&#34;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/London&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><h2 id="get-a-specific-schedule">Get a specific schedule</h2>
<p>Let&rsquo;s try to get a schedule that doesn&rsquo;t exist:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules?id=Manually-added-schedule-1&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">117</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">117</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">14563</span>      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:-- <span style="color:#0000cf;font-weight:bold">29250</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;error&#34;</span> : <span style="color:#4e9a06">&#34;Bad Request&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;message&#34;</span> : <span style="color:#4e9a06">&#34;REST SCHEDULER: Schedule ID Manually-added-schedule-1 not found.&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;statusCode&#34;</span> : <span style="color:#0000cf;font-weight:bold">400</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>Here&rsquo;s a schedule that <em>does</em> exist (as per the API call above):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules?id=3702cec1-b6c8-463e-bda3-58d6a94dd9ac&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">354</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">354</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">50499</span>      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:--  115k
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2021-10-08T07:24:38.373Z&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;* */2 * * *&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;3702cec1-b6c8-463e-bda3-58d6a94dd9ac&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 2 hours&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag 3&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/London&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><h2 id="add-new-schedule">Add new schedule</h2>
<p>Note how we get back information about the newly created schedule. It&rsquo;s the same data that was sent to the API method, with the addition of schedule id, created timestamp and last known state.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;POST&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules&#34;</span> -H <span style="color:#4e9a06">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#4e9a06">$&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;timezone&#34;: &#34;Europe/Stockholm&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;tags&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;tag 1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;abc 123 åäö&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  ],
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;qlikSenseTaskId&#34;: &#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;name&#34;: &#34;Every 5 sec&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;cronSchedule&#34;: &#34;*/5 * * * * *&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  &#34;startupState&#34;: &#34;started&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">}&#39;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">544</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">307</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">237</span>  <span style="color:#0000cf;font-weight:bold">21470</span>  <span style="color:#0000cf;font-weight:bold">16574</span> --:--:-- --:--:-- --:--:-- <span style="color:#0000cf;font-weight:bold">49454</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2021-10-27T05:15:28.580Z&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;*/5 * * * * *&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;b028d0a2-7116-41bf-b15a-4f01bd126464&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 5 sec&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag 1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/Stockholm&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>Looking in the Butler logs we see that the every-5-seconds schedule with an ID ending in &hellip;a300 indeed fires every 5 seconds:</p>
<p><img src="butler-logs-new-schedule-1.png" alt="alt text" title="New schedule fires every 5 seconds"></p>
<h2 id="starting-and-stopping-a-schedule">Starting and stopping a schedule</h2>
<p>Let&rsquo;s stop the schedule we just created:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules/b028d0a2-7116-41bf-b15a-4f01bd126464/stop&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>     <span style="color:#0000cf;font-weight:bold">2</span>  <span style="color:#0000cf;font-weight:bold">100</span>     <span style="color:#0000cf;font-weight:bold">2</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>    <span style="color:#0000cf;font-weight:bold">246</span>      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:--   <span style="color:#0000cf;font-weight:bold">500</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>If we get info about this schedule, it should have <code>lastKnownState</code>=stopped&hellip; Let&rsquo;s verify.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules?id=fb9b16f1-e2cf-4291-8036-24ef90efa300&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">307</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">307</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>    99k      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:--   99k
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2020-10-16T15:23:36.957Z&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;*/5 * * * * *&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;fb9b16f1-e2cf-4291-8036-24ef90efa300&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;stopped&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 5 sec&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag 1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/Stockholm&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>Great!</p>
<p>As a final step, let&rsquo;s start the schedule again, as well as verifying it was successfully started:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules/fb9b16f1-e2cf-4291-8036-24ef90efa300/start&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">309</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">309</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">77250</span>      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:-- <span style="color:#0000cf;font-weight:bold">77250</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2020-10-16T15:23:36.957Z&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;*/5 * * * * *&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;fb9b16f1-e2cf-4291-8036-24ef90efa300&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 5 sec&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>         <span style="color:#4e9a06">&#34;tag 1&#34;</span>,
</span></span><span style="display:flex;"><span>         <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/Stockholm&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>➜  ~ curl <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/schedules?id=fb9b16f1-e2cf-4291-8036-24ef90efa300&#34;</span> <span style="color:#000;font-weight:bold">|</span> json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">307</span>  <span style="color:#0000cf;font-weight:bold">100</span>   <span style="color:#0000cf;font-weight:bold">307</span>    <span style="color:#0000cf;font-weight:bold">0</span>     <span style="color:#0000cf;font-weight:bold">0</span>   149k      <span style="color:#0000cf;font-weight:bold">0</span> --:--:-- --:--:-- --:--:--  149k
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;created&#34;</span> : <span style="color:#4e9a06">&#34;2020-10-16T15:23:36.957Z&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;cronSchedule&#34;</span> : <span style="color:#4e9a06">&#34;*/5 * * * * *&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;id&#34;</span> : <span style="color:#4e9a06">&#34;fb9b16f1-e2cf-4291-8036-24ef90efa300&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;lastKnownState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;name&#34;</span> : <span style="color:#4e9a06">&#34;Every 5 sec&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;qlikSenseTaskId&#34;</span> : <span style="color:#4e9a06">&#34;0fe447a9-ba1f-44a9-ac23-68c3a1d88d8b&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;startupState&#34;</span> : <span style="color:#4e9a06">&#34;started&#34;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;tags&#34;</span> : <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag 1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;abc 123 åäö&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#4e9a06">&#34;timezone&#34;</span> : <span style="color:#4e9a06">&#34;Europe/Stockholm&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>All good!</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5230cabc1ee17ee5a7b958adafbe276d">3 - Reload task chaining with parameters</h1>
    <div class="lead">Examples showing how to use Butler&rsquo;s key-value store to pass parameters between apps in a reload chain, using calls to Butler&rsquo;s API.</div>
	<h2 id="reload-chaining-with-parameters-à-la-butler">Reload chaining with parameters à la Butler</h2>
<p>First: Some people argue that apps in an ETL chain should be atomic and not pass parameters to each other.</p>
<p>There is certainly some merit to this view, but there are also cases where you just have to tell the following app(s) what happened in a previous step in the reload chain. Some kind of parameter passing is thus needed.</p>
<p>Passing parameters between apps in a QMC reload chain can be done in various ways.</p>
<p>The most common option is to use what&rsquo;s available in Sense out of the box:<br>
Store the parameters in a disk file (CSV, QVD etc) in the first app, then load the parameters back into the second app when it is reloading.</p>
<p>Butler offers a different approach: Store and manipulate named key-value pairs within Butler, using its REST API.</p>
<p>It works like this:</p>
<p><img src="butler-key-value-store-1.png" alt="alt text" title="Passing parameters between Sense apps using Butler"></p>
<p>Pretty easy, right?</p>
<p>One more thing. There is an optional but useful property for each KV pair: TTL, or time-to-live.</p>
<p>If a ttl is set (in milliseconds) for a KV pair, it will be automatically deleted when the ttl clock expire. This is an easy way to keep the Butler key-value store nice and tidy.</p>
<h3 id="data-connections-not-included">Data connections not included</h3>
<p>In order to call Butler&rsquo;s REST API you need a couple of REST data connections defined in Qlik Sense. The apps described in this example assumes <code>Butler_Get</code> and <code>Butler_POST</code> exists. They look like this:</p>
<h4 id="butler_get">Butler_GET</h4>
<p>This data connection is trivial. When creating it any REST API that responds to GET requests can be used. Later on (before the calls to the Butler API) the URL will be replaced with the correct one = host:port where Butler is running.</p>
<p><img src="butler-api-dc-get-1.png" alt="alt text" title="GET data connection part "></p>
<h4 id="butler_post">Butler_POST</h4>
<p>This data connection is a bit more complex.</p>
<p>First, in order to create the connection you need a REST endpoint that takes a POST with data passed in the body of the message. The data connection used by the apps in this example are found below. Note the http method, the request body and the <code>Content-Type</code> Query header. Any other settings can be ignored.</p>
<p>Secondly, Qlik Sense&rsquo;s REST connector only supports GET and POST methods over http. That&rsquo;s fine in this particular case, because we&rsquo;ll use a POST to create a new key-value pair. On a generel levels it&rsquo;s however really quite bad that Qlik&rsquo;s REST connector only supports GET and POST: PUT, DELETE and other http methods are certainly also used out there on the Internet, and should be supported too.</p>
<p>Some of the Butler API endpoints use PUT or DELETE methods, which is nothing strange at all - rather the opposite. Butler tries to follow best practices when it comes to using GET, POST, PUT and DELETE at the appropriate times.</p>
<p>We still need a way to invoke PUT and DELETE endpoints from Sense load script.
This is done in the script, by adding an extra http header in the call to Butler&rsquo;s API: <code>X-HTTP-Method-Override</code></p>
<p>If <code>X-HTTP-Method-Override</code> is set to PUT in the call to Butler&rsquo;s API, the Butler will convert the call to a PUT call before it reaches the message dispatching within Butler. Same thing for DELETEs.</p>
<p><img src="butler-api-dc-post-1.png" alt="alt text" title="POST data connection part 1"></p>
<p><img src="butler-api-dc-post-2.png" alt="alt text" title="POST data connection part 2"></p>
<p><img src="butler-api-dc-post-3.png" alt="alt text" title="POST data connection part 3"></p>
<h2 id="parameter-passing-in-action">Parameter passing in action</h2>
<p>The scenario is as follows:</p>
<ul>
<li>App 1 needs to pass a parameter called &ldquo;Paramater 1&rdquo; to App 2</li>
<li>App 2 is scheduled to reload either directly or in some later stage after App 1.</li>
<li>App 1 stores the parameter in Butler&rsquo;s key-value store during reload of App 1.</li>
<li>When App 2 reloads it pulls the parameter from the KV store.</li>
</ul>
<p>When App 1 reloads the reload window looks like this. Note how the app has created a key-value pair within Butler.</p>
<p><img src="reload-chain-parameter-app-1-1.png" alt="alt text" title="Reload log from App 1, first part of reload chain"></p>
<p>App 2 is scheduled to reload when App 1 has finished reloading. Note that we get back the same value that was set by App 1. Mission accomplished.</p>
<p><img src="reload-chain-parameter-app-2-1.png" alt="alt text" title="Reload log from App 2, second part of reload chain"></p>
<h2 id="qlik-script-for-passing-parameters-between-apps">Qlik script for passing parameters between apps</h2>
<p>Let&rsquo;s take a closer look at the two apps. The apps are available in the sense_apps directory of <a href="https://github.com/ptarmiganlabs/butler">the Butler repository on GitHub</a>.</p>
<p>The apps are called <code>Butler 4.0 - Reload chain parameters, app 1.qvf</code> and <code>Butler 4.0 - Reload chain parameters, app 2.qvf</code>.</p>
<h3 id="app-1">App 1</h3>
<p>The app has three script sections, each is shown below.</p>
<h4 id="script-section-1-init">Script section 1: Init</h4>
<p>The interesting parts here are the two variables towards the end. These tell the rest of the script where Butler is running.</p>
<pre tabindex="0"><code>SET ThousandSep=&#39;,&#39;;
SET DecimalSep=&#39;.&#39;;
SET MoneyThousandSep=&#39;,&#39;;
SET MoneyDecimalSep=&#39;.&#39;;
SET MoneyFormat=&#39;$#,##0.00;-$#,##0.00&#39;;
SET TimeFormat=&#39;h:mm:ss TT&#39;;
SET DateFormat=&#39;M/D/YYYY&#39;;
SET TimestampFormat=&#39;M/D/YYYY h:mm:ss[.fff] TT&#39;;
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale=&#39;en-US&#39;;
SET CreateSearchIndexOnReload=1;
SET MonthNames=&#39;Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec&#39;;
SET LongMonthNames=&#39;January;February;March;April;May;June;July;August;September;October;November;December&#39;;
SET DayNames=&#39;Mon;Tue;Wed;Thu;Fri;Sat;Sun&#39;;
SET LongDayNames=&#39;Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday&#39;;
SET NumericalAbbreviation=&#39;3:k;6:M;9:G;12:T;15:P;18:E;21:Z;24:Y;-3:m;-6:μ;-9:n;-12:p;-15:f;-18:a;-21:z;-24:y&#39;;


// The Butler instance is running at this IP/port:
let vButlerHost = &#39;192.168.1.168&#39;;
let vButlerPort = &#39;8080&#39;;
</code></pre><h4 id="script-section-2-sub-definitions">Script section 2: Sub definitions</h4>
<p>Here we define two subs: One to get a bit more friendly looking trace messages, and one that encapsulates the code needed to store key-value pairs in Butler.</p>
<pre tabindex="0"><code>// ------------------------------------------------------------
// ** Time stamped trace messages **
//
// Get nice trace lines in the reload log by calling the line with 
// CALL NiceTrace(&#39;My trace message. Variable value=$(vVariableName)&#39;);
//
// Paramaters:
// vMsg                  : Message sent to reload log
// ------------------------------------------------------------
sub NiceTrace(vMsg)
    let vNow = Now(1);
    TRACE &gt;&gt;&gt; $(vNow): $(vMsg);

    // Clear timestamp variable
    set vNow=;
end sub



// ------------------------------------------------------------
// ** Add key-value pair to a namespace **
//
// Paramaters:
// vNamespace            : Namespace in which the KV pair will be stored
// vKey                  : Key name
// vValue                : Value to store together with key
// vTimeToLive           : How long should the KV pair exist before being automatically deleted?
//                         Set to 0 to disable TTL feature (=no auto-delete of KV pair)
// ------------------------------------------------------------
sub AddKeyValue(vNamespace, vKey, vValue, vTimeToLive)
    LIB CONNECT TO &#39;Butler_POST&#39;;

    if (vTimeToLive&gt;0) then
        let vRequestBody = &#39;{&#34;key&#34;: &#34;$(vKey)&#34;, &#34;value&#34;: &#34;$(vValue)&#34;, &#34;ttl&#34;: &#34;$(vTimeToLive)&#34;}&#39;;
    else
        let vRequestBody = &#39;{&#34;key&#34;: &#34;$(vKey)&#34;, &#34;value&#34;: &#34;$(vValue)&#34;}&#39;;
    end if

    // Escape &#34; in request body 
    let vRequestBody = replace(vRequestBody,&#39;&#34;&#39;, chr(34)&amp;chr(34));

    RestConnectorMasterTable:
    SQL SELECT 
        &#34;namespace&#34;,
        &#34;key&#34;,
        &#34;value&#34;,
        &#34;ttl&#34;
    FROM JSON (wrap on) &#34;root&#34;
    WITH CONNECTION (
    Url &#34;http://$(vButlerHost):$(vButlerPort)/v4/keyvalues/$(vNamespace)&#34;,
    BODY &#34;$(vRequestBody)&#34;,
    HTTPHEADER &#34;Content-Type&#34; &#34;application/json&#34;
    );

    DROP TABLE RestConnectorMasterTable;
end sub
</code></pre><h4 id="script-section-3-write-parameters-to-kv-store">Script section 3: Write parameters to KV store</h4>
<p>Finally, the code needed to actually store the parameter in Butler is just a few lines:</p>
<pre tabindex="0"><code>// Create key-value pair in Butler&#39;s key-value store. 

Call NiceTrace(&#39;---------------------------&#39;)
Call NiceTrace(&#39;Writing parameter to Butler key-value store. No time-to-live (ttl).&#39;)
Call AddKeyValue(&#39;Reload chain parameter demo&#39;, &#39;Parameter 1&#39;, &#39;a1 abc 123&#39;, 0)

Call NiceTrace(&#39;Written parameter to key-value store: &#39;)
Call NiceTrace(&#39;Namespace=&#34;Reload chain parameter demo&#34;, Key=&#34;Parameter 1&#34;, Value=&#34;a1 abc 123&#34;&#39;)
</code></pre><h3 id="app-2">App 2</h3>
<h4 id="script-section-1-init-1">Script section 1: Init</h4>
<p>Set host and port where Butler is running. Exactly the same script as in App 1.</p>
<pre tabindex="0"><code>SET ThousandSep=&#39;,&#39;;
SET DecimalSep=&#39;.&#39;;
SET MoneyThousandSep=&#39;,&#39;;
SET MoneyDecimalSep=&#39;.&#39;;
SET MoneyFormat=&#39;$#,##0.00;-$#,##0.00&#39;;
SET TimeFormat=&#39;h:mm:ss TT&#39;;
SET DateFormat=&#39;M/D/YYYY&#39;;
SET TimestampFormat=&#39;M/D/YYYY h:mm:ss[.fff] TT&#39;;
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale=&#39;en-US&#39;;
SET CreateSearchIndexOnReload=1;
SET MonthNames=&#39;Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec&#39;;
SET LongMonthNames=&#39;January;February;March;April;May;June;July;August;September;October;November;December&#39;;
SET DayNames=&#39;Mon;Tue;Wed;Thu;Fri;Sat;Sun&#39;;
SET LongDayNames=&#39;Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday&#39;;
SET NumericalAbbreviation=&#39;3:k;6:M;9:G;12:T;15:P;18:E;21:Z;24:Y;-3:m;-6:μ;-9:n;-12:p;-15:f;-18:a;-21:z;-24:y&#39;;


// The Butler instance is running at this IP/port:
let vButlerHost = &#39;192.168.1.168&#39;;
let vButlerPort = &#39;8080&#39;;
</code></pre><h4 id="script-section-2-sub-definitions-1">Script section 2: Sub definitions</h4>
<p>Here we define a NiceTrace sub, and a sub for retrieving key-value pairs from Butler.</p>
<pre tabindex="0"><code>// ------------------------------------------------------------
// ** Time stamped trace messages **
//
// Get nice trace lines in the reload log by calling the line with
// CALL NiceTrace(&#39;My trace message. Variable value=$(vVariableName)&#39;);
//
// Paramaters:
// vMsg                  : Message sent to reload log
// ------------------------------------------------------------
sub NiceTrace(vMsg)
    let vNow = Now(1);
    TRACE &gt;&gt;&gt; $(vNow): $(vMsg);

    // Clear timestamp variable
    set vNow=;
end sub



// ------------------------------------------------------------
// ** Get key-value pair from a namespace **
//
// Paramaters:
// vNamespace            : Namespace in which the KV pair will be stored
// vKey                  : Key name
// vResultVarName        : Name of variable in wich value will be placed
// ------------------------------------------------------------
sub GetKeyValue(vNamespace, vKey, vResultVarName)
    LIB CONNECT TO &#39;Butler_GET&#39;;

    RestConnectorMasterTable:
    SQL SELECT 
        &#34;key&#34;,
        &#34;value&#34;
    FROM JSON (wrap on) &#34;root&#34;
    WITH CONNECTION (
    Url &#34;http://$(vButlerHost):$(vButlerPort)/v4/keyvalues/$(vNamespace)?key=$(vKey)&#34;
    );

    let $(vResultVarName) = Peek(&#39;value&#39;, 0, &#39;RestConnectorMasterTable&#39;);
    set vResultVarName=;

    DROP TABLE RestConnectorMasterTable;
end sub
</code></pre><h4 id="script-section-3-read-parameter-from-kv-store">Script section 3: Read parameter from KV store</h4>
<p>Again, the code needed to interact with the key-value API is pretty compact:</p>
<pre tabindex="0"><code>// Define variable to store the retrieved parameter in
let vParam1=&#39;&#39;;

Call NiceTrace(&#39;---------------------------&#39;)
Call NiceTrace(&#39;Loading parameter from Butler key-value store.&#39;)
Call GetKeyValue(&#39;Reload chain parameter demo&#39;, &#39;Parameter 1&#39;, &#39;vParam1&#39;)

Call NiceTrace(&#39;Retrieved parameter value:&#39;)
Call NiceTrace(&#39;Namespace=&#34;Reload chain parameter demo&#34;, Key=&#34;Parameter 1&#34;, Value=&#34;$(vParam1)&#34;&#39;)
set vParam1=;
</code></pre>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-623bc4dd163a7c6e1fbd68416cc6196b">4 - Monitoring Butler&#39;s memory usage using Grafana</h1>
    <div class="lead">Butler can be configured to store its own memory usage in InfluxDB.<br>
Here we look at how this works and how Grafana real-time charts can be created.</div>
	<p>Butler can optionally store uptime information (Butler version number and memory usage) in <a href="https://docs.influxdata.com/influxdb/v1/">InfluxDB</a> or <a href="https://newrelic.com">New Relic</a>.<br>
InfluxDB is a database for time-series data such as measurements, while New Relic is an enterprise grade, SaaS observability solution.</p>
<p>Once in InfluxDB it&rsquo;s easy to create nice monitoring charts in <a href="https://grafana.com/">Grafana</a> or similar tools.<br>
New Relic has their own built-in dashboard tool (but Grafana can actually load data from New Relic too!).</p>
<p>But hey - why spend CPU cycles and disk space on this?</p>
<p>Well, if you are serious about your Qlik Sense Enterprise environment, you should also be serious about your supporting tools and microservices, Butler included.</p>
<p>Even though Butler over the years has proven to be a very stable piece of software, there is always the risk of new features misbehaving or new bugs appearing.<br>
It&rsquo;s thus a good idea to monitor for example how much memory (RAM) tools like Butler use over time and alert if things go wrong.</p>
<h2 id="enable-butlers-uptime-monitor">Enable Butler&rsquo;s uptime monitor</h2>
<p>Both he uptime monitor and the logging to desired destination (InfluxDB or New Relic) must be enabled. Note that there are two settings for this. If your InfluxDB uses authentication you&rsquo;ll need to enable this too in Butler&rsquo;s config file.</p>
<p>If you use New Relic to monitor your uptime metrics you must first define the New Relic API credentials in the Butler config file&rsquo;s <code>Butler.thirdPartyToolsCredentials.newRelic</code> settings, then configure the uptime monitoring specifics in <code>Butler.uptimeMonitor.storeNewRelic</code>.</p>
<p>The uptime monitoring part of the config file could looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Uptime monitor</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">uptimeMonitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#8f5902;font-style:italic"># Should uptime messages be written to the console and log files?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">frequency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">every 15 minutes    </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># https://bunkat.github.io/later/parsers.html</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">logLevel</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">verbose              </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Starting at what log level should uptime messages be shown?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storeInInfluxdb</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#8f5902;font-style:italic"># Should Butler memory usage be logged to InfluxDB?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storeNewRelic</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">destinationAccount</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">First NR account</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">Second NR account</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># There are different URLs depending on whther you have an EU or US region New Relic account.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># The available URLs are listed here: https://docs.newrelic.com/docs/accounts/accounts-billing/account-setup/choose-your-data-center/</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># As of this writing the options for the New Relic metrics API are</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># https://insights-collector.eu01.nr-data.net/metric/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># https://metric-api.newrelic.com/metric/v1 </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://insights-collector.eu01.nr-data.net/metric/v1  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Where should uptime data be sent?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">header</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># Custom http headers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">X-My-Header</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Header value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">metric</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dynamic</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">butlerMemoryUsage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Should Butler&#39;s memory/RAM usage be sent to New Relic?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">butlerUptime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Should Butler&#39;s uptime (how long since it was started) be sent to New Relic?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">attribute</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">static</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Static attributes/dimensions to attach to the data sent to New Relic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">metricType</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">butler-uptime</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">service</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">butler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">environment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">prod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dynamic</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">butlerVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Should the Butler version be included in the data sent to New Relic?</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="creating-a-influxdb-database">Creating a InfluxDB database</h2>
<p>When starting Butler for the first time and InfluxDB is enabled, it will connect to InfluxDB and if needed create a new database with a name controlled by the <code>Butler.influxDb.dbName</code> setting in the Butler config file.<br>
A retention policy with its name controlled by the <code>Butler.influxDb.retentionPolicy.name</code> setting in the Butler config file will also be created:</p>
<pre tabindex="0"><code>2023-12-14T17:25:29.851Z info: CONFIG: Influxdb enabled: true
2023-12-14T17:25:29.851Z info: CONFIG: Influxdb host IP: 192.168.1.51
2023-12-14T17:25:29.852Z info: CONFIG: Influxdb host port: 8086
2023-12-14T17:25:29.852Z info: CONFIG: Influxdb db name: butler
2023-12-14T17:25:30.614Z info: CONFIG: Created new InfluxDB database: butler
2023-12-14T17:25:30.746Z info: --------------------------------------
2023-12-14T17:25:30.746Z info: Starting Butler
2023-12-14T17:25:30.747Z info: Log level      : info
2023-12-14T17:25:30.747Z info: App version    : 9.4.0
...
</code></pre><p>Note that the only thing needed is a running InfluxDB instance. Butler creates the database in InfluxDB if needed, together with a retention policy that is defined in the Butler config file.</p>
<h2 id="hey-data-are-you-there">Hey data, are you there?</h2>
<p>So far so good. Let&rsquo;s wait a few minutes and then verify that New Relic and/or InfluxDB has received a few dataspoints.<br>
The interval between the uptime messages is controlled by the <code>Butler.uptimeMonitor.frequency</code> setting in the Butler config file.</p>
<p>Using the InfluxDB command line client to connect to InfluxDB we can do a manual query:</p>
<p><img src="butler-new-influxdb-2.png" alt="alt text" title="Manual query of Butler data in InfluxDB"></p>
<p>Indeed, there are a few data points in InfluxDB. Butler&rsquo;s uptime monitor seems to be working.</p>
<h2 id="butler--influxdb--grafana--">Butler + InfluxDB + Grafana = 🎉📈</h2>
<p>Grafana has excellent support for InfluxDB, it&rsquo;s therefore a good way to visualise Butler memory use over time.</p>
<p>To use the Grafana dashboard included in the Butler GitHub repository you first need to create a Grafana data source named <code>Butler ops metrics</code>, and point it to the InfluxDB database in which Butler stores its data.</p>
<p>Once the Grafana data source is in place and working you can import the Grafana dashboard file <code>Butler operational metrics.json</code> (available in the docs/grafana folder in the GitHub repo).</p>
<p>If everything works you&rsquo;ll see something like this:</p>
<p><img src="butler-grafana-1.png" alt="alt text" title="Butler memory metrics in Grafana"></p>
<p>Looks like Butler is using ca 70 MByte here. This is pretty normal, memory usage is usually around 100 MByte, even when Butler has been running for days, weeks and months. Exact memory usage will vary depending on which features are enabled.</p>
<p>Butler&rsquo;s version number is also included in the data sent to InfluxDB.</p>
<p>This means that you can easily create a Grafana dashboard showing which Butler version is running on which server.<br>
If you have multiple Butler instances running in your environment, this can be very useful.</p>
<p><img src="butler-grafana-versions-1.png" alt="alt text" title="Butler version number in Grafana"></p>
<h2 id="butler--new-relic--">Butler + New Relic = 😎🌟</h2>
<p>While InfluxDB combined with Grafana is hard to beat when it comes to flexibility and look&rsquo;n&rsquo;feel of the dashboards, New Relic is outstanding when it comes to ease of setup.</p>
<p>New Relic is a SaaS product which means you don&rsquo;t have to host neither databaes nor dashboard tool yourself.<br>
It&rsquo;s all there within New Relic.</p>
<p>What about cost? Is New Relic expensive?</p>
<p>Well, if you have lots of metrics, log files etc New Relic can become quite expensive as they charge you based on how much data you send to New Relic.<br>
But given that Butler will send <em>very little</em> data you are unlikely to ever reach the limit of New Relic&rsquo;s free tier.<br>
There is thus a good chance you won&rsquo;t even have to pay for New Relic if you only use it to monitor Butler.</p>
<p>A New Relic chart showing Butler memory usage can look like this:</p>
<p><img src="/img/butler-memory-usage-new-relic-1.png" alt="alt text" title="Butler memory usage in Grafana dashboard"></p>
<p>Similarly to the Grafana dashboard, Butler&rsquo;s version number is also included in the data sent to New Relic, and can be used to create a chart showing which Butler version is running on which server:</p>
<p><img src="butler-new-relic-versions-1.png" alt="alt text" title="Butler version numbers in New Relic dashboard"></p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8660cd4d7d82d2525980be7a70d69444">5 - Start Sense tasks using Butler APIs</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-9ec46b6cc378b2854c350e850ccc1a0e">5.1 - Start Sense tasks using REST API</h1>
    
	<h2 id="use-butlers-rest-api-to-start-sense-tasks">Use Butler&rsquo;s REST API to start Sense tasks</h2>
<p>If the Butler config file is properly set up it&rsquo;s possible to start Sense tasks by doing a PUT or POST call to /v4/reloadtask/{taskId}/start endpoint.</p>
<p>A great use case is to have upstream systems that feed Qlik Sense with data trigger a Sense task when new data is available.<br>
That way Sense doesn&rsquo;t have to poll for new data, with less system resources used in both upstream system and in Sense.</p>
<p><em><strong>AND</strong></em> users get the new data as quickly as possible!</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">General principles</h4>

    <p>The API docs contain the best info for how the API works, a few things to keep in mind though:</p>
<ul>
<li>Butler will verify that all specified task IDs exist before trying to start them. Invalid task IDs will be reported in the http response.</li>
<li>If the <code>allTaskIdsMustExist</code> URL parameter is set to <code>true</code> it means that <strong>all</strong> specified task IDs must be valid for <strong>any</strong> of them to be started.
<ul>
<li>Tasks associated with tags and custom properties are not affected by the <code>allTaskIdsMustExist</code> flag.</li>
</ul>
</li>
</ul>

</div>

<h2 id="requirements">Requirements</h2>
<p>These config file settings must be set up before Butler can use the REST API to start tasks:</p>
<ul>
<li>Configure Butler&rsquo;s REST server:
<ul>
<li>Butler.restServerConfig.enable: true</li>
<li>Butler.restServerConfig.serverHost: &lt;IP or hostname where Butler&rsquo;s REST server is running&gt;</li>
<li>Butler.restServerConfig.serverPort: <Port where Butler is exposing its REST server></li>
<li>Butler.restServerConfig.backgroundServerPort: <Port used by Butler internally></li>
</ul>
</li>
<li>Enable the start task API endpoint
<ul>
<li>Butler.restServerEndpointsEnable.senseStartTask: true</li>
</ul>
</li>
</ul>
<h2 id="seeing-is-believing">Seeing is believing</h2>
<p>The video below is available at <a href="https://www.youtube.com/channel/UCpQblhippq-KfWkXEEYFHTQ">Ptarmigan Labs&rsquo; YouTube channel</a> and also in the <a href="https://www.youtube.com/playlist?list=PLUuyY5OOOsz3XX5YT2QEwa7dzaBT1kOCP">Butler playlist</a>.</p>
<p>The video gives a quick demo of what calling the APIs can look like when using macOS.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/5m6FPRqhN14?enablejsapi=1"
                 allowfullscreen></iframe>
</div>
<br>
There are many tools that can be used to call REST APIs.  
<p><a href="https://www.postman.com">Postman</a> is cross platform and works in the browser, <a href="https://paw.cloud">Paw</a> is outstanding if you&rsquo;re using macOS - and many others.</p>
<p>In the examples below we keep it simple and just use curl to call the API.</p>
<p>Note:</p>
<ul>
<li>This API requires an empty array to be passed in the body even when no tags, custom properties or similar are used.</li>
<li>In the examples Butler is exposing its API on 192.168.1.168:8080</li>
</ul>
<h3 id="start-a-single-task-using-task-id">Start a single task using task ID</h3>
<p>Using a <code>PUT</code> call to start task with ID <code>e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e/start&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>One task was started.</li>
<li>No task IDs were invalid.</li>
<li>No task IDs were denied based on task filtering.</li>
<li>No tasks were started or denied using tags or custom properties.</li>
</ul>
<h3 id="start-a-single-task-using-an-invalid-task-id">Start a single task using an invalid task ID</h3>
<p>The task ID <code>abc123</code> is invalid. This will be detected and reported in the response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/abc123/start&#34;</span> -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> -d <span style="color:#4e9a06">$&#39;[]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;abc123&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><h3 id="start-multiple-tasks-using-valid-task-ids">Start multiple tasks using valid task IDs</h3>
<p>In this example all task IDs are valid. One of them is passed in the URL and the other two in the message body.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/-/start&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>The magic task ID &ldquo;-&rdquo; will be ignored.</li>
<li>Two tasks, specified in the request body, were started.</li>
</ul>
<h3 id="start-multiple-tasks-using-task-ids-all-task-ids-must-exist-task-filtering-on">Start multiple tasks using task IDs, all task IDs must exist, task filtering ON</h3>
<p>Here two task IDs are valid and on the list of approved task IDs. One task ID is invalid (too short).<br>
As <code>allTaskIdsMustExist=true</code> we expect that no task is started (<em>all</em> task IDs must exist for <em>any</em> task to be started based on task ID!).
Task filtering is turned on in the config file&rsquo;s <code>Butler.startTaskFilter.enable</code> entry.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e/start?allTaskIdsMustExist=true&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>No tasks were started based on task IDs.</li>
<li>One invalid (too short!) task is returned in the response.</li>
<li>As there was one or more invalid task IDs, the two valid and approved task IDs were not started.
Their task IDs are returned in the denied array in the response.</li>
</ul>
<h3 id="start-multiple-tasks-using-task-ids-all-task-ids-must-exist-task-filtering-off">Start multiple tasks using task IDs, all task IDs must exist, task filtering OFF</h3>
<p>Here two task IDs are valid and on the list of approved task IDs. One task ID is invalid (too short).<br>
As <code>allTaskIdsMustExist=true</code> we expect that no task is started (<em>all</em> task IDs must exist for <em>any</em> task to be started based on task ID!).
Task filtering is turned off in the config file&rsquo;s <code>Butler.startTaskFilter.enable</code> entry.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e/start?allTaskIdsMustExist=true&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response and its message is the same as in the previous example:</p>
<ul>
<li>No tasks were started based on task IDs.</li>
<li>One invalid (too short!) task is returned in the response.</li>
<li>As there was one or more invalid task IDs, the two valid and approved task IDs were not started.
Their task IDs are returned in the denied array in the response.</li>
</ul>
<h3 id="start-multiple-tasks-using-task-ids-task-filtering-on">Start multiple tasks using task IDs, task filtering ON</h3>
<ul>
<li>Two task IDs are valid and on the list of approved task IDs.</li>
<li>One task ID is valid but not on list of approved task IDs.</li>
<li>One task ID is invalid (too short).</li>
<li>Task filtering is turned on in the config file&rsquo;s <code>Butler.startTaskFilter.enable</code> entry.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e/start&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskid&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;taskId&#34;: &#34;8b4fe424-d90c-493f-a61d-0ce91cd485c9&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;8b4fe424-d90c-493f-a61d-0ce91cd485c9&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>Two tasks were started, as their task IDs were approved in the config file.</li>
<li>One task ID was invalid (too short!).</li>
<li>One task ID had a valid format but was not on the list of approved task IDs.</li>
</ul>
<h3 id="start-tasks-using-tags">Start tasks using tags</h3>
<p>The underlying Qlik Sense system has two tags associated with tasks: <code>startTask1</code> and <code>startTask2</code>.</p>
<p>The QMC shows which tasks have these tags set:</p>
<p><img src="qmc-tasks-with-tags-1.png" alt="Qlik Sense QMC tasks with tags" title="Tasks with tags starting with 'start'"></p>
<p>Starting the three tasks tagged with <code>startTask1</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/-/start&#34;</span> -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttasktag&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;tag&#34;: &#34;startTask1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>Three tasks were started because they had a tag matching the one specified in the call to the API.</li>
<li>One invalid task ID was specified. This is the one in the URL - if needed it&rsquo;s ok to provide a dummy task ID, as done here.</li>
</ul>
<h3 id="start-tasks-using-custom-properties">Start tasks using custom properties</h3>
<p>A custom property <code>taskGroup</code> available on reload tasks have the following possible values:</p>
<p><img src="qmc-cp-definition-1.png" alt="Qlik Sense QMC custom property" title="Definition of custom property taskGroup'"></p>
<p>Here&rsquo;s a call that will start all tasks that have the custom property <code>taskGroup</code> set to either <code>tasks1</code> or <code>tasks2</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/-/start?allTaskIdsMustExist=false&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskcustomproperty&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;customPropertyName&#34;: &#34;taskGroup&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;customPropertyValue&#34;: &#34;tasks1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;starttaskcustomproperty&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;customPropertyName&#34;: &#34;taskGroup&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;customPropertyValue&#34;: &#34;tasks2&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><p>The response tells us:</p>
<ul>
<li>3 unique tasks were started.</li>
<li>As the task &ldquo;Reload task of App2&rdquo; had both values set for the custom property, this task was started twice.</li>
</ul>
<h3 id="sending-parameters-to-apps">Sending parameters to apps</h3>
<p>Sometimes there is a need to send parameters from outside of Sense to an app that should be reloaded.<br>
This is supported by Butler as follows:</p>
<ol>
<li>Start a task and pass in one or more key-value pairs (=the parameters that should be sent to the app(s)) in the body of the call.</li>
<li>Have the app being reloaded read the key-value pairs from within the load script, using the Butler APIs.</li>
<li>Optional: Clear up (delete KV pairs or the namespace used) the key-value store when done.</li>
</ol>
<p>Here a single task, identified by its ID in the URL, is started.<br>
Two key-value pairs are passed along as parameters to the app. One has a TimeToLive of 10 seconds, the other has no TTL (=it will not be automatically deleted).</p>
<p>Task filtering is off, i.e. any task can be started using this API.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/fbf645f0-0c92-40a4-af9a-6e3eb1d3c35c/start&#34;</span> -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> -d <span style="color:#4e9a06">$&#39;[
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;keyvaluestore&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;value&#34;: &#34;TheValue&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;namespace&#34;: &#34;MyFineNamespace&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;key&#34;: &#34;AnImportantKey&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;ttl&#34;: 10000
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  },
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;type&#34;: &#34;keyvaluestore&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    &#34;payload&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;value&#34;: &#34;Bar&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;namespace&#34;: &#34;MyFineNamespace&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">      &#34;key&#34;: &#34;Foo&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">]&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fbf645f0-0c92-40a4-af9a-6e3eb1d3c35c&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload Operations Monitor&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div><h3 id="a-bit-of-everything">A bit of everything</h3>
<p>Combining all of the above can look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  ~ curl -X <span style="color:#4e9a06">&#34;PUT&#34;</span> <span style="color:#4e9a06">&#34;http://192.168.1.168:8080/v4/reloadtask/e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e/start?allTaskIdsMustExist=true&#34;</span> -H <span style="color:#4e9a06">&#39;Content-Type: application/json; charset=utf-8&#39;</span> -d $<span style="color:#a40000">&#39;</span><span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttaskid&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttaskid&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttasktag&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag&#34;</span>: <span style="color:#4e9a06">&#34;startTask1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttasktag&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;tag&#34;</span>: <span style="color:#4e9a06">&#34;startTask2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttaskcustomproperty&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;customPropertyName&#34;</span>: <span style="color:#4e9a06">&#34;taskGroup&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;customPropertyValue&#34;</span>: <span style="color:#4e9a06">&#34;tasks1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;starttaskcustomproperty&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;customPropertyName&#34;</span>: <span style="color:#4e9a06">&#34;taskGroup&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;customPropertyValue&#34;</span>: <span style="color:#4e9a06">&#34;tasks2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;keyvaluestore&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;value&#34;</span>: <span style="color:#4e9a06">&#34;TheValue&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;namespace&#34;</span>: <span style="color:#4e9a06">&#34;MyFineNamespace&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;key&#34;</span>: <span style="color:#4e9a06">&#34;AnImportantKey&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;ttl&#34;</span>: <span style="color:#0000cf;font-weight:bold">10000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;keyvaluestore&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;payload&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;namespace&#34;</span>: <span style="color:#4e9a06">&#34;MyFineNamespace&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;key&#34;</span>: <span style="color:#4e9a06">&#34;Foo&#34;</span>,                                                                                                                                                                                               &lt;....
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksId&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;started&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;invalid&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;denied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTag&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksTagDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCP&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;e3b27f50-b1c0-4879-88fc-c7cdd9c1cf3e&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;fb0f317d-da91-4b86-aafa-0174ae1e8c8f&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskId&#34;</span>: <span style="color:#4e9a06">&#34;7552d9fc-d1bb-4975-9a38-18357de531ea&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;taskName&#34;</span>: <span style="color:#4e9a06">&#34;Reload task of App2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;tasksCPDenied&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>➜  ~
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-14f1eed47ec7650ca73aa0b550f5b150">5.2 - Start Sense tasks from load script of Sense apps</h1>
    
	<h2 id="helper-functions-included">Helper functions included</h2>
<p>It is very much possible to call Butler&rsquo;s REST API from the load script of Sense apps.<br>
Create a REST connector in the Sense editor, configure it for the endpoint you want to call and use it from the load script.</p>
<p>This works but is tedious and quickly leads to lots of script code - especially if you need to make many calls to the Butler API.</p>
<p>To make things a bit easier the Butler GitHub repository includes a set of helper .qvs files.<br>
These contain functions/subs that encapsulate various Butler APIs (include starting tasks) and make them easier to use.</p>
<p>Just include the <a href="https://github.com/ptarmiganlabs/butler/blob/master/docs/sense_script/butler_subs.qvs">butler_subs.qvs</a> file from the GitHub release package and you get (among many other things) a helper function that&rsquo;s called <code>StartTask</code>.</p>
<h2 id="requirements-for-starting-tasks-via-rest-api">Requirements for starting tasks via REST API</h2>
<p>These config file settings must be set up before Butler can use the REST API to start tasks:</p>
<ul>
<li>Connection to Qlik Sense:
<ul>
<li>Butler.configQRS.*</li>
</ul>
</li>
<li>Configure Butler&rsquo;s REST server:
<ul>
<li>Butler.restServerConfig.enable: true</li>
<li>Butler.restServerConfig.serverHost: &lt;IP or hostname where Butler&rsquo;s REST server is running&gt;</li>
<li>Butler.restServerConfig.serverPort: <Port where Butler is exposing its REST server></li>
<li>Butler.restServerConfig.backgroundServerPort: <Port used by Butler internally></li>
</ul>
</li>
<li>Enable the start task API endpoint
<ul>
<li>Butler.restServerEndpointsEnable.senseStartTask: true</li>
</ul>
</li>
<li>Sense data connections as described in the <a href="/docs/getting-started/setup/data-connections">Getting started</a> section.</li>
</ul>
<h2 id="helper-functions">Helper functions</h2>
<p>There are two helper functions/sub for starting tasks:</p>
<ul>
<li><code>StartTask(...)</code> is a generic function that can be called with a single task ID, or with complex combinations of task IDs, tags, custom properties and key-value pairs.</li>
<li><code>StartTask_KeyValue(...)</code> makes it easy to start a single task and pass along one key-value pair as parameter. This function is essentially a specialized version of the more generic <code>StartTask</code> sub.</li>
</ul>
<h3 id="start-a-single-task">Start a single task</h3>
<p>The function(=sub in Sense lingo) <code>StartTask</code> takes a single <code>taskId</code> parameter,  which means that starting a reload task from an app&rsquo;s load script is as simple as</p>
<pre><code>Call StartTask(&lt;TaskId&gt;)
</code></pre>
<p>The demo app <code>Butler 8.4 demo app.qvf</code> (<a href="https://github.com/ptarmiganlabs/butler/tree/master/docs/sense_apps">link</a>) contains such a demo (and many others).</p>
<h3 id="need-to-pass-along-parameters-to-a-task-theres-a-sub-for-that">Need to pass along parameters to a task? There&rsquo;s a Sub for that!</h3>
<p>Sometimes you need to send parameters to a reload task (or rather to the load script of the app associated with the task).<br>
This can be done by using the <code>StartTask_KeyValue</code> helper function/Sub.</p>
<p>That Sub takes a taskId as parameter (similarly to its <code>StartTask</code> sibling), but it also takes parameters for a full key-value pair:</p>
<pre><code>Call StartTask_KeyValue('fbf645f0-0c92-40a4-af9a-6e3eb1d3c35c', 'MyNamespace', 'An important key', 'The value', 3000)
</code></pre>
<p>The parameters are</p>
<ul>
<li>The namespace to store the key-value pair in (required).</li>
<li>The key (required).</li>
<li>The value (required).</li>
<li>An time-to-live valud in milliseconds (optional). When the ttl times out the key-value pair is automatically deleted.</li>
</ul>
<p>Documentation about Butler&rsquo;s key-value store is available <a href="/docs/concepts/key-value/">here</a>.</p>
<p>An example showing how task chaining with parameters can be done using key-values is found <a href="/docs/examples/reload-chaining/">here</a>.</p>
<h3 id="start-several-tasks-using-task-ids">Start several tasks using task IDs</h3>
<p>If several tasks should be started using task IDs, those IDs need to be passed into the <code>StartTask</code> sub.<br>
This is done by storing the task IDs in a separate table whose name is passed as a parameter into <code>StartTask</code>:</p>
<p>These tables can be called anything as long as</p>
<ol>
<li>They are qualified (i.e. keep the &ldquo;Qualify *;&rdquo; statement!).</li>
<li>The table names are passed as parameters to the StartTask function.</li>
<li>The table MUST have a field called <code>TaskId</code> that contains the IDs of reload tasks to be started.</li>
</ol>
<p>Regarding parameters to StartTask:</p>
<ol>
<li>Trailing, unused parameters can be omitted.</li>
<li>Unused parameters that are followed by used parameters should be set to Null().</li>
</ol>
<h3 id="example-1">Example 1</h3>
<p>The script below will start tasks <code>fbf645f0-0c92-40a4-af9a-6e3eb1d3c35c</code> (via the first parameter), <code>7552d9fc-d1bb-4975-9a38-18357de531ea</code> (via second parameter, i.e. a table) and <code>fb0f317d-da91-4b86-aafa-0174ae1e8c8f</code> (via second parameter too).</p>
<pre tabindex="0"><code>Qualify *;

ButlerTaskIDs:
Load * Inline [
TaskId
7552d9fc-d1bb-4975-9a38-18357de531ea
fb0f317d-da91-4b86-aafa-0174ae1e8c8f
];

Call StartTask(&#39;fbf645f0-0c92-40a4-af9a-6e3eb1d3c35c&#39;, &#39;ButlerTaskIDs&#39;)

Unqualify *;
</code></pre><h3 id="example-2">Example 2</h3>
<p>Same as previous example, except that the first parameter is not used.<br>
It must still be specified though! Set to <code>Null()</code> to indicate it isn&rsquo;t used.</p>
<p>The script below will thus start tasks <code>7552d9fc-d1bb-4975-9a38-18357de531ea</code> and <code>fb0f317d-da91-4b86-aafa-0174ae1e8c8f</code>.</p>
<pre tabindex="0"><code>Qualify *;

ButlerTaskIDs:
Load * Inline [
TaskId
7552d9fc-d1bb-4975-9a38-18357de531ea
fb0f317d-da91-4b86-aafa-0174ae1e8c8f
];

Call StartTask(Null(), &#39;ButlerTaskIDs&#39;)

Unqualify *;
</code></pre><h3 id="start-tasks-using-tags">Start tasks using tags</h3>
<p>Similar to how multiple tasks can be started using a table of task IDs (see above), tasks can also be started using a table containing tag names.</p>
<h3 id="example-1-1">Example 1</h3>
<p>The script below will start all reload tasks that have the <code>startTask1</code> or <code>startTask2</code> tag set.</p>
<pre tabindex="0"><code>Qualify *;

ButlerTags:
Load * Inline [
Tag
startTask1
startTask2
];

Call StartTask(, Null(), &#39;ButlerTags&#39;)

Unqualify *;
</code></pre><h3 id="start-tasks-using-custom-properties">Start tasks using custom properties</h3>
<p>Similar to how multiple tasks can be started using a table of task IDs (see above), tasks can also be started using a table containing custom property names and values.</p>
<h3 id="example-1-2">Example 1</h3>
<p>The script below will start all reload tasks that have the <code>taskGroup</code> custom property set to a value of <code>tasks1</code>.</p>
<pre tabindex="0"><code>Qualify *;

ButlerCustomProperties:
Load * Inline [
Name, Value
taskGroup, tasks1
];

Call StartTask(, Null(), Null(), &#39;ButlerKeyValues&#39;)

Unqualify *;
</code></pre><h2 id="seeing-is-believing">Seeing is believing</h2>
<p>The video below is available at <a href="https://www.youtube.com/channel/UCpQblhippq-KfWkXEEYFHTQ">Ptarmigan Labs&rsquo; YouTube channel</a> and also in the <a href="https://www.youtube.com/playlist?list=PLUuyY5OOOsz3XX5YT2QEwa7dzaBT1kOCP">Butler playlist</a>.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/5m6FPRqhN14?enablejsapi=1"
                 allowfullscreen></iframe>
</div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a68f4373aa21a7c97708868e6800c445">5.3 - Start Sense tasks using MQTT</h1>
    
	<h2 id="use-mqtt-to-start-sense-tasks">Use MQTT to start Sense tasks</h2>
<p>Butler can be configured to listen to a specific MQTT topic (specified in config file property <code>Butler.mqttConfig.taskStartTopic</code>) and use any message received in that topic as a Sense task ID, which is then started.</p>
<p>For example:</p>
<ul>
<li>A Sense app, used by end users, relies on data in a source system that talks MQTT (there are <em>lots</em> of MQTT libraries available, covering most operating systems).</li>
<li>The data in the source system can be updated at any time.</li>
</ul>
<p>In order to update the Sense app with data the most common approach is to schedule reloads of the Qlik Sense app at certain intervals, i.e. polling the source system.</p>
<p>But if the source system instead posts a MQTT message on a well defined topic when new data is available, theat message will trigger the Sense app&rsquo;s reload.</p>
<p>This way the Sense app will be updated as quickly as possible after new data is availabe in the source system.</p>
<p><em><strong>I.e. the end user will have access to more up-to-date data, compared to the polling based solution.</strong></em></p>
<h2 id="requirements-for-starting-tasks-via-mqtt">Requirements for starting tasks via MQTT</h2>
<p>These config file settings must be set up before Butler will use MQTT messages to start tasks:</p>
<ul>
<li>Connection to MQTT broker (=server):
<ul>
<li>Butler.mqttConfig.enable: true</li>
<li>Butler.mqttConfig.brokerHost: <IP or host name of MQTT broker></li>
<li>Butler.mqttConfig.brokerPort: <Port where MQTT broker is listening></li>
</ul>
</li>
<li>MQTT topics that Butler should subscribe to
<ul>
<li>Butler.mqttConfig.subscriptionRootTopic: &lt;Root topic that Butler should subscribe to. Something like <code>qliksense/#</code>&gt;</li>
<li>Butler.mqttConfig.taskStartTopic: &lt;Topic used to start Sense tasks. <em>MUST</em> be a suptopic to the root topic above!&gt;</li>
</ul>
</li>
</ul>
<h2 id="seeing-is-believing">Seeing is believing</h2>
<p>The video below is available at <a href="https://www.youtube.com/channel/UCpQblhippq-KfWkXEEYFHTQ">Ptarmigan Labs&rsquo; YouTube channel</a> and also in the <a href="https://www.youtube.com/playlist?list=PLUuyY5OOOsz3XX5YT2QEwa7dzaBT1kOCP">Butler playlist</a>.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/5m6FPRqhN14?enablejsapi=1"
                 allowfullscreen></iframe>
</div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0b7938483d12cedb172dda070edbd078">6 - Controlled and secure file system operations</h1>
    <div class="lead"><p>For security reasons Qlik Sense does not offer direct access to the file system from load scripts. Using lib:// constructs files can be read and written, but not copied, moved or deleted.</p>
<p>Butler has APIs that enabled file copy/move/delete in a secure, controlled way.</p>
</div>
	<h2 id="goal-copy-move-and-delete-files-from-sense-load-scripts">Goal: Copy, move and delete files from Sense load scripts</h2>
<p>These steps are needed to achieve the goal:</p>
<ol>
<li>Install and configure Butler&rsquo;s general settings.</li>
<li>Add the directories in which file operations should be allowed to Butler&rsquo;s config file.<br>
Make sure the account Butler runs under has the appropriate access to those directories.</li>
<li>Make sure the <a href="/docs/getting-started/setup/data-connections">necessary Sense data connections</a> exist.</li>
<li>Call the Butler APIs directly or use the subs included in the GitHub repo to do the desired file operations.</li>
</ol>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning: UNC paths only on Windows</h4>

    <p>UNC paths (i.e. &ldquo;\\host\fileshare\folder1\folder2&rdquo;) is a Windows-only feature and as such only supported when Butler is running on Windows.</p>
<p>If Butler is running on a non-Windows operating system and directories on network file shares should be accessible via Butler&rsquo;s RESR API, those directories must be mounted on the server using the standard OS mechanisms, then accessed via the server&rsquo;s local file system.</p>
<p>Butler will warn in the console and file logs if UNC paths are specified in the config file, and Butler is NOT running on Windows.</p>


</div>

<h3 id="1-install-and-configure-butler">1. Install and configure Butler</h3>
<p>Described <a href="https://butler.ptarmiganlabs.com/docs/getting-started/setup/">here</a>.</p>
<h3 id="2-add-approved-directories-to-butler-config-file">2. Add approved directories to Butler config file</h3>
<p>The general idea is:<br>
For each file system operation (copy, move and delete) you can specify in which (or between which) directories that operation should be allowed.</p>
<p>This is straight forward, but because Butler can run on different operating systems AND access file shares hosted by various OSs, things can get a bit complicated.<br>
In most cases the paths to use are the expected ones, but when it comes to UNC paths they can for example either use forward slash &ldquo;/&rdquo; or back ditto &ldquo;\&rdquo;.<br>
Both work as all paths are normalized into an internal, uniform format when loaded into Butler.</p>
<p>Note that all subdirectories of the directories listed in the config file are also considered to be approved directories by Butler.</p>
<p>A few examples show how to deal with some common scenarios:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileCopyApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/data1/qvd          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Butler running on Linux, with either a local directory in /data1, or a remote fileshare mounted into /data1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/data2/qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e:\data3\qvd        </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Butler running on Windows Server, accessing files/directories in the local file system</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e:\data4\qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//server1.my.domain/fileshare1/data1  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Butler running on Windows server, accessing a SMB file share (which can be on a Windows or Linux server)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//server1.my.domain/fileshare1/data2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">\\server1.my.domain\fileshare1\data1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">\\server1.my.domain\fileshare1\data2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileMoveApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/data7/qvd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/data8/qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e:\data9\qvd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e:\data10\qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//server2.my.domain/data1/qvd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//server2.my.domain/data1/qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileDeleteApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">/data1/qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">e:\data1\qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">//server3.my.domain/data1/qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">\\server3.my.domain\data1\qvd_archive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This configuration (for example) means:</p>
<ul>
<li>Copying can be done from <code>e:\data3\qvd</code> to <code>e:\data4\qvd_archive</code>, but <em>not</em> from <code>e:\data3\qvd</code> to <code>e:\data6\qvd_archive</code></li>
<li>Moving files can be done from <code>/data7/qvd</code> to <code>/data8/qvd_archive</code>, but <em>not</em> from <code>/data7/qvd</code> to <code>e:\data9\qvd</code></li>
<li>Files can be deleted in the directories <code>/data1/qvd_archive</code>, <code>e:\data1\qvd_archive</code> and (using UNC notation) <code>\\server3.my.domain\data1\qvd_archive</code>.</li>
</ul>
<h3 id="3-create-sense-data-connections-used-to-call-butlers-rest-api">3. Create Sense data connections used to call Butler&rsquo;s REST API</h3>
<p>Described <a href="/docs/getting-started/setup/data-connections/">here</a>.</p>
<h3 id="4-call-the-butler-apis-or-use-convenience-subs">4. Call the Butler APIs or use convenience subs</h3>
<p>Once you know what file path format to use (see above), using the helper subs is pretty easy:</p>
<pre tabindex="0"><code>// Where is Butler running?
let vButlerHost = &#39;http://10.11.12.13&#39;;
let vButlerPort = 8080;

// Delete files
Call DeleteFile(&#39;/data1/qvd_archive/a.txt&#39;)
Call DeleteFile(&#39;e:\data1\qvd_archive\a.txt&#39;)
Call DeleteFile(&#39;//server3.my.domain/data1/qvd_archive\a.txt&#39;)

// Copy files with options overwrite-if-exists=true and keep-source-timestamp=true
Call CopyFile(&#39;/data1/qvd/a.txt&#39;, &#39;/data2/qvd_archive/a.txt&#39;, &#39;true&#39;, &#39;true&#39;)
Call CopyFile(&#39;e:\data5\qvd\a.txt&#39;, &#39;e:\data6\qvd_archive\a.txt&#39;, &#39;true&#39;, &#39;true&#39;)

// Move files with option overwrite-if-exists=true
Call MoveFile(&#39;/data7/qvd/a.txt&#39;, &#39;/data8/qvd_archive/a.txt&#39;, &#39;true&#39;)
Call MoveFile(&#39;e:\data9\qvd\a.txt&#39;, &#39;e:\data10\qvd_archive\a.txt&#39;, &#39;true&#39;)
</code></pre><p>If you prefer to call the REST API directly, the DeleteFile sub might provide some inspiration:</p>
<pre tabindex="0"><code>// ------------------------------------------------------------
// ** Delete file **
//
// Files can only be deleted in folders (and subfolders of) directories that 
// have been approved in the Butler config file.
//
// Paramaters:
// vFile                : File to be deleted. 
// ------------------------------------------------------------
sub DeleteFile(vFile)
    let vFile = Replace(&#39;$(vFile)&#39;, &#39;\&#39;, &#39;/&#39;);
    let vFile = Replace(&#39;$(vFile)&#39;, &#39;#&#39;, &#39;%23&#39;);

    let vRequestBody = &#39;{&#34;&#34;deleteFile&#34;&#34;:&#34;&#34;$(vFile)&#34;&#34;}&#39;;

    LIB CONNECT TO &#39;Butler_POST&#39;;

    RestConnectorMasterTable:
    SQL SELECT 
        &#34;vFile&#34;
    FROM JSON (wrap on) &#34;root&#34;
    WITH CONNECTION (
    Url &#34;$(vButlerHost):$(vButlerPort)/v4/filedelete&#34;,
    BODY &#34;$(vRequestBody)&#34;,
    HTTPHEADER &#34;X-HTTP-Method-Override&#34; &#34;DELETE&#34;
    );

    set vFile=;
    set vRequestBody=;
    DROP TABLE RestConnectorMasterTable;
end sub
</code></pre><p>Note how the HTTP operation is set using the X-HTTP-Method-Override HTTP header.</p>
<p>This is a way to work around a limitation of Qlik&rsquo;s REST connector, as it only supports GET and POST operations. The extra HTTP header tells Butler what kind of HTTP operation should <em>really</em> be carried out.</p>
<h2 id="examples-using-unc-paths">Examples using UNC paths</h2>
<p>When specifying UNC paths in the Butler config file and running Butler on a non-Windows operating system, you will get warnings like the ones below.</p>
<p>The approved directories sections of the config file look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">Butler</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">....</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># List of directories between which file copying via the REST API can be done.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileCopyApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/from/some/directory2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/to/some/directory2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//1.2.3.4/qlik/testdata/deletefile1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//1.2.3.4/qlik/testdata/deletefil2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># List of directories between which file moves via the REST API can be done.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileMoveApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/from/some/directory3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/to/some/directory3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">fromDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//1.2.3.4/qlik/testdata/deletefile1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">toDirectory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">//1.2.3.4/qlik/testdata/deletefil2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fileDeleteApprovedDirectories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">/from/some/directory2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">\\1.2.3.4\qlik\testdata\deletefile3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In this case Butler is running on macOS (with IP 192.168.1.168 on port 8081) and we get warnings in the logs when starting Butler:</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/docs/examples/file-copy-move-delete/butler-unc-path-on-macos-1_hub0140fda08b2ed7b924ad7993ce02ecc_403942_900x0_resize_catmullrom_3.png" width="900" height="487">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
Startup warnings about non-compatible UNC paths when running Butler on macOS.
</p>
	</figcaption>
	
</figure>

<p>When trying to do a file operation (in this case a delete) using an UNC path (Butler is still running on macOS!) we get a warning in the logs and a http error returned to the Sense script:</p>







<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 610px">
	<img class="card-img-top" src="/docs/examples/file-copy-move-delete/butler-unc-path-on-macos-3_huc4484a1ad59c1f3d808b4922bdc8b74b_92556_600x0_resize_catmullrom_3.png" width="600" height="622">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
http error returned when trying to delete a file via a UNC path, and Butler is running on macOS.
</p>
	</figcaption>
	
</figure>








<figure class="card rounded p-2 td-post-card mb-4 mt-4" style="max-width: 910px">
	<img class="card-img-top" src="/docs/examples/file-copy-move-delete/butler-unc-path-on-macos-2_hu5ed2892a2e541c6b69bf232609c4388b_72162_900x0_resize_catmullrom_3.png" width="900" height="109">
	
	<figcaption class="card-body px-0 pt-2 pb-0">
		<p class="card-text">
Warnings in log for the previous scenario.
</p>
	</figcaption>
	
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d2af2c1244624a9acc9a66e66172d1fb">7 - Sense apps that explain and highlight various Butler features</h1>
    <div class="lead"><p>Butler comes with several demo apps.</p>
<p>Feel free to review them to get a better understanding of how Butler can be used.</p>
</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-80b3dd32c9d3f4baac903f189466eec8">7.1 - Using Butler APIs from Sense load script</h1>
    <div class="lead"><p>This app uses the helper subs call some of Butler&rsquo;s APIs.   It&rsquo;s not diving too deep into any particular feature, but rather just calls most APIs to show how it&rsquo;s done.</p>
<p>If unsure what the parameters of the helper subs should look like, this page might be useful.</p>
</div>
	<h2 id="calling-the-butler-api-from-sense-apps-load-script">Calling the Butler API from Sense app&rsquo;s load script</h2>
<p>The demo app <code>Butler 5.0 - demo app.qvf</code> is available in the <a href="https://github.com/ptarmiganlabs/butler/tree/master/docs/sense_apps">GitHub repository</a>.</p>
<p>The app includes examples on how to use many of Butler&rsquo;s REST APIs endpoints.<br>
It doesn&rsquo;t have much of a user interface (it just shows what API endpoints are enabled) so you should look at the load script to get examples of how to use the Butler APIs.</p>
<p>The app includes a copy of the <a href="/docs/reference/sense-helper-subs/">helper functions</a> that are also available in the GitHub repository.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-43c4ed843dd44f1efb5f941ab5acde72">7.2 - Partial loads in Qlik Sense</h1>
    <div class="lead"><p>It&rsquo;s surprisingly difficult to do partial loads in Qlik Sense Enterprise on Windows.<br>
In QlikView that feature was easily available, but in QSEoW it&rsquo;s currently not possible to create reload tasks that do partial app reloads.</p>
<p>Butler has an API for doing partial reloads of apps. A couple of demo apps are also includedin the GitHub repository.</p>
</div>
	<h2 id="partial-reload-api">Partial reload API</h2>
<p>The full API documentation is available in the <a href="/docs/reference/rest-api/?operationsSorter=alpha">Reference section</a>, here we&rsquo;re interested in the PUT <code>/v4/app/{appId}/reload</code> endpoint.</p>
<h2 id="demo-apps-for-partial-reloads">Demo apps for partial reloads</h2>
<p>A couple of apps showing how to use Butler&rsquo;s partial load API are <a href="https://github.com/ptarmiganlabs/butler/tree/master/docs/sense_apps">included in the GitHub repository</a>.</p>
<ul>
<li>The first app&rsquo;s load script uses the Butler API to do full and partial reloads of the second app.</li>
<li>The second app loads 10 rows of data during a full reload and 5 rows during a partial reload.</li>
</ul>
<p><img src="butler-demo-partial-reload-1.png" alt="alt text" title="Partial app reloads using Butler."></p>
<h2 id="video-showing-how-to-use-demo-apps">Video showing how to use demo apps</h2>
<p>Available at <a href="https://www.youtube.com/channel/UCpQblhippq-KfWkXEEYFHTQ">Ptarmigan Labs&rsquo; YouTube channel</a> and also in the <a href="https://www.youtube.com/playlist?list=PLUuyY5OOOsz3XX5YT2QEwa7dzaBT1kOCP">Butler YouTube playlist</a>.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/0xh10ErPy6c?enablejsapi=1"
                 allowfullscreen></iframe>
</div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bbc60cbb61fac1179012dec229c48586">7.3 - Post message to Slack</h1>
    <div class="lead">Demo app showing how to post message to Slack from Qlik Sense load script.</div>
	<h2 id="load-script">Load script</h2>
<p>Assuming the <a href="/docs/reference/sense-helper-subs/">.qvs helper subs</a> are used, only one line of script is needed to send a Slack message:</p>
<pre><code>// -------------------------------------------
// Post messsage to Slack
// -------------------------------------------
// Post a basic message to Slack
Call PostToSlack('#general', 'Butler the Bot', '👽 Greetings, we come in peace.' , ':ghost:')
</code></pre>
<p>Note how emojis can be used in the message and a message specific icon can be used (&quot;:ghost:&quot; above).</p>
<p>The Slack message looks like this:</p>
<p><img src="/img/butler-slack-message-1.png" alt="alt text" title="Slack message created from Qlik Sense load script."></p>
<p>The demo app is available in the <a href="https://github.com/ptarmiganlabs/butler/tree/master/docs/sense_apps">GitHub repository</a>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7125aa4f0e91e8edd48c7230f440bf3b">7.4 - Publish message to MQTT</h1>
    <div class="lead">Demo app showing how to publish message to MQTT from Qlik Sense load script.</div>
	<h2 id="load-script">Load script</h2>
<p>Assuming the <a href="/docs/reference/sense-helper-subs/">.qvs helper subs</a> are used, only one line of script is needed to publish a MQTT message.</p>
<p>The demo app does a bit more. First it posts a startup message to MQTT, then it loads some data and finally an all-done message is sent:</p>
<pre><code>// -------------------------------------------
// Publish a MQTT message, load some data and publish another message
Call PostToMQTT('butler/5.0/demo-reloading/status', 'reload started')

// Load some data
Characters:
Load Chr(RecNo()+Ord('A')-1) as Alpha, RecNo() as Num autogenerate 26;

// Publish final message
Call PostToMQTT('butler/5.0/demo-reloading/status', 'reload done')
</code></pre>
<p>The MQTT messages look like this in the <a href="http://mqtt-explorer.com/">MQTT Explorer</a> app on mac OS:</p>
<p><img src="/img/butler-publish-mqtt-message-1.png" alt="alt text" title="MQTT messages created from Qlik Sense load script."></p>
<p>The demo app is available in the <a href="https://github.com/ptarmiganlabs/butler/tree/master/docs/sense_apps">GitHub repository</a>.</p>
<h2 id="seeing-is-believing">Seeing is believing</h2>
<p>The video below is available at <a href="https://www.youtube.com/channel/UCpQblhippq-KfWkXEEYFHTQ">Ptarmigan Labs&rsquo; YouTube channel</a> and also in the <a href="https://www.youtube.com/playlist?list=PLUuyY5OOOsz3XX5YT2QEwa7dzaBT1kOCP">Butler playlist</a>.</p>
<div class="embed-responsive embed-responsive-16by9">
        <iframe src="https://www.youtube.com/embed/GtOojhW5HsA?enablejsapi=1"
                 allowfullscreen></iframe>
</div>

</div>



    
      
  
  
  
  

  
  

  

    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-89b0a8b47f0fe64f0420ca0c37b51a0f">8 - Run Butler as a Windows service</h1>
    
	<p>If running Butler on a Windows computer it is possible to install Butler as a Windows service.</p>
<p>This means that Butler will start automatically when the computer starts, and will run in the background without any user interaction.</p>
<p>A blog post on <a href="https://ptarmiganlabs.com/the-lazy-qlik-developer-2-setting-up-butler-sos/">ptarmiganlabs.com</a> goes through the steps required to install <em>Butler SOS</em> as a Windows service, the steps needed for <em>Butler</em> are virtually identical.</p>
<p>This topic is is also discussed on the <a href="/docs/getting-started/operations/">Day 2 operations</a> page.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="SenseOps mailing list" aria-label="SenseOps mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://ptarmiganlabs.com/#/portal/signup" aria-label="SenseOps mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Discussion forums on GitHub" aria-label="Discussion forums on GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/ptarmiganlabs/butler/discussions" aria-label="Discussion forums on GitHub">
      <i class="fa fa-comments"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Ptarmigan Labs" aria-label="Ptarmigan Labs">
    <a class="text-white" target="_blank" rel="noopener" href="https://ptarmiganlabs.com" aria-label="Ptarmigan Labs">
      <i class="fa fa-external-link"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.linkedin.com/in/gorsan/" aria-label="LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/ptarmiganlabs/butler" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Bug reports &amp; Feature requests" aria-label="Bug reports &amp; Feature requests">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/ptarmiganlabs/butler/issues/new/choose" aria-label="Bug reports &amp; Feature requests">
      <i class="fa fa-bug"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Get in touch with Ptarmigan Labs" aria-label="Get in touch with Ptarmigan Labs">
    <a class="text-white" target="_blank" rel="noopener" href="mailto://info@ptarmiganlabs.com" aria-label="Get in touch with Ptarmigan Labs">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2023 Ptarmigan Labs AB All Rights Reserved</small>
        
	
		<p class="mt-2"><a href="/docs/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
  <script src="/js/main.min.4b4b57ad1d873cb4f343c9c480e8cbaacb1009203802312c2e85766a42806372.js" integrity="sha256-S0tXrR2HPLTzQ8nEgOjLqssQCSA4AjEsLoV2akKAY3I=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
